global
    log stdout format raw local0
    maxconn 4096
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms
    retries 3

# Statistics endpoint
listen stats
    bind *:8404
    stats enable
    stats uri /
    stats refresh 10s
    stats admin if TRUE

# HTTP API Load Balancer
frontend http_frontend
    bind *:8080
    mode http
    default_backend http_backend

backend http_backend
    mode http
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200

    # Health check every 2 seconds
    server node1 node1:8080 check inter 2s fall 3 rise 2
    server node2 node2:8080 check inter 2s fall 3 rise 2
    server node3 node3:8080 check inter 2s fall 3 rise 2

# gRPC API Load Balancer
frontend grpc_frontend
    bind *:9090
    mode tcp
    default_backend grpc_backend

backend grpc_backend
    mode tcp
    balance roundrobin
    option tcp-check

    server node1 node1:9090 check inter 2s fall 3 rise 2
    server node2 node2:9090 check inter 2s fall 3 rise 2
    server node3 node3:9090 check inter 2s fall 3 rise 2
