# Default values for raftkv Helm chart
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Number of RaftKV replicas (minimum 3 for Raft quorum)
replicaCount: 3

# Image configuration
image:
  repository: raftkv
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: "latest"

# Image pull secrets for private registries
imagePullSecrets: []

# Override the name of the chart
nameOverride: ""
fullnameOverride: ""

# ServiceAccount configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  name: ""

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "2112"
  prometheus.io/path: "/metrics"

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000
  runAsNonRoot: true

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# Services configuration
service:
  # LoadBalancer service for client access
  type: LoadBalancer
  httpPort: 8080
  grpcPort: 9090
  annotations: {}
  # For LoadBalancer type
  # loadBalancerIP: ""
  # loadBalancerSourceRanges: []

  # Headless service for Raft peer-to-peer communication
  headless:
    enabled: true
    raftPort: 7000
    metricsPort: 2112
    publishNotReadyAddresses: true

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: raftkv.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: raftkv-tls
  #    hosts:
  #      - raftkv.local

# Resource requests and limits
resources:
  requests:
    cpu: 1000m
    memory: 2Gi
  limits:
    cpu: 2000m
    memory: 4Gi

# Persistent storage configuration
persistence:
  enabled: true
  # storageClass: "fast-ssd"  # Use specific storage class
  accessMode: ReadWriteOnce
  size: 10Gi
  annotations: {}

# Pod anti-affinity for high availability
# Use "required" for production (requires multiple nodes)
# Use "preferred" for development (works on single node)
affinity:
  podAntiAffinity:
    # Change to requiredDuringSchedulingIgnoredDuringExecution for production
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: raftkv
          topologyKey: kubernetes.io/hostname

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Liveness probe configuration
livenessProbe:
  enabled: true
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Readiness probe configuration
readinessProbe:
  enabled: true
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# RaftKV application configuration
raftkv:
  # Raft configuration
  raft:
    enabled: true
    # Bootstrap is handled automatically for raftkv-0
    # heartbeatTimeout: 1s
    # electionTimeout: 1s
    # commitTimeout: 50ms
    # snapshotInterval: 120s
    # snapshotThreshold: 8192

  # Storage configuration
  storage:
    dataDir: /var/lib/raftkv
    wal:
      enabled: true
      syncWrites: false
      batchSize: 100
      batchTimeout: 10ms
    cache:
      enabled: true
      maxSize: 10000

  # Authentication configuration
  auth:
    enabled: true
    # JWT secret will be generated or can be provided
    jwtSecret: ""  # Leave empty to generate random secret
    # Default admin password (CHANGE IN PRODUCTION!)
    adminPassword: "admin"
    tokenExpiry: 24h

  # Server configuration
  server:
    httpAddr: :8080
    grpcAddr: :9090
    readTimeout: 30s
    writeTimeout: 30s
    maxHeaderBytes: 1048576

  # Observability
  observability:
    logging:
      level: info
      format: json
    metrics:
      enabled: true
      port: 2112

  # TLS configuration
  tls:
    enabled: false
    # If enabled, provide certificate via secret
    certFile: /etc/raftkv/tls/server-cert.pem
    keyFile: /etc/raftkv/tls/server-key.pem
    caFile: /etc/raftkv/tls/ca-cert.pem
    # Name of secret containing TLS certificates
    secretName: raftkv-tls

# RBAC configuration
rbac:
  create: true

# ServiceMonitor for Prometheus Operator
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s
  # Additional labels for ServiceMonitor
  additionalLabels: {}
    # release: prometheus

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 2
  # maxUnavailable: 1

# Update strategy
updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    partition: 0

# Init containers for setup
initContainers:
  enabled: true
  image: busybox:1.36

# Additional environment variables
extraEnv: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"

# Additional volumes
extraVolumes: []
  # - name: custom-volume
  #   emptyDir: {}

# Additional volume mounts
extraVolumeMounts: []
  # - name: custom-volume
  #   mountPath: /custom-path

# ConfigMap for additional configuration files
configMap:
  # Additional configuration files to mount
  data: {}
    # custom-config.yaml: |
    #   key: value
